{% extends "liquidacionmensual/liqmensual_list.html" %}
{% load staticfiles %}
{% load django_bootstrap_breadcrumbs %}
{% load humanize %}
{% load l10n %}

{% block breadcrumbs %}
    {{ block.super }}
    {% breadcrumb " Liquidaciones Pendientes " 'liquidacion:index' %}
{% endblock %}

{% block content %}
{% render_breadcrumbs %}

<div class="col-12 col-sm-10 recuadro">

{% if advertencia %}
<div class="alert alert-warning alert-dismissible fade show" role="alert">
    {{ advertencia }}
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
{% endif %}

<form method="post" id="liquidacion_form">
    {% csrf_token %}
    <div class="row text-center">
        <div class="col-12 text-center">
            <h5><strong>Liquidacion Salarial N° {{ liquidacion.pk }}</strong></h5>
        </div>
    </div><!--fin titulo-->
    <hr>
{% if liquidacion.estado_actual.name != 'Confirmado' %}
    <div class="row mt-2"> <!-- botones -->
        <div class="col-12">
            <div class="row">
                {% if liquidacion.tipo.nombre == 'Definitiva' %}
                <div class="col-md-3 col-sm-3 btn_sep">
                    <button type="submit" form="liquidacion_form"
                            name="boton" value="Definitiva"
                            formaction="{% url 'liquidacion:editar_liquidacion' liquidacion.pk %}"
                            class="btn" style="width: 100%">
                        Confirmar
                    </button>
                </div>
                {% else %}
                <div class="col-md-4 col-sm-3 btn_sep">
                    <button type="submit" form="liquidacion_form"
                            name="boton" value="Descartado"
                            formaction="{% url 'liquidacion:editar_liquidacion' liquidacion.pk %}"
                            class="btn btn-secondary" style="width: 100%">
                        Descartar
                    </button>
                </div>
                <div class="col-md-4 col-sm-3 btn_sep">
                    <button type="submit" form="liquidacion_form"
                            name="boton" value="Confirmado"
                            formaction="{% url 'liquidacion:editar_liquidacion' liquidacion.pk %}"
                            class="btn btn-success" style="width: 100%">
                        Confirmar
                    </button>
                </div>
                <div class="col-md-4 col-sm-3 btn_sep">
                    <button type="submit" form="liquidacion_form"
                            name="boton" value="Borrador"
                            formaction="{% url 'liquidacion:editar_liquidacion' liquidacion.pk %}"
                            class="btn btn-primary" style="width: 100%">
                        Guardar Borrador
                    </button>
                </div>
                {% endif %}
            </div>
        </div>
    </div><!-- fin botones -->
    <hr>
    <input type="hidden" name="ultimamodificacion" value="{{liquidacion.ultimamodificacion|unlocalize }}">
    <input type="hidden" name="propietario" value="{{ liquidacion.propietario }}">
    <input type="hidden" name="tipo" value="{{ liquidacion.tipo }}">
    <input type="hidden" name="estado_actual" value="{{ liquidacion.estado_actual.pk }}">
{% endif %}

    <div class="row"> <!-- cuerpo del formulario-->
        <div class="col-12" style="font-size: 12px">
            <div class="row">
                <div class="col-4 d-flex align-items-center">
                    <ul class="list-inline">
                        <li class="list-inline-item"><strong>Funcionario: </strong></li>
                        <br/>
                        <li class="list-inline-item">{{ liquidacion.funcionario }}</li>
                        <input type="hidden" name="funcionario" value="{{ liquidacion.funcionario.pk }}">
                    </ul>
                </div>
                <div class="col-4 d-flex">
                    <ul class="list-inline">
                        <li class="list-inline-item"><strong>Creada el: </strong>
                            {{ liquidacion.fechacreacion|date:"d/m/Y H:i" }}</li>
                            <input type="hidden" name="fechacreacion" value="{{ liquidacion.fechacreacion|date:"Y-m-d H:i" }}">
                        <br/>
                        <li class="list-inline-item"><strong>Mes: </strong>{{ liquidacion.mes.nombre }}</li>
                            <input type="hidden" name="mes" value="{{ liquidacion.mes.pk }}">
                        <br/>
                        <li class="list-inline-item">
                            <strong>Periodo: Del </strong>{{ liquidacion.inicio_periodo|date:"d/m/Y" }}
                            <strong>hasta el </strong>{{ liquidacion.fin_periodo|date:"d/m/Y" }}</li>
                            <input type="hidden" name="inicio_periodo" value="{{ liquidacion.inicio_periodo|date:"Y-m-d H:i" }}">
                            <input type="hidden" name="fin_periodo" value="{{ liquidacion.fin_periodo|date:"Y-m-d H:i" }}">
                        <br/>
                    </ul>
                </div>
                <div class="col-4 d-flex">
                     <ul class="list-inline">
                        <li class="list-inline-item"><strong>Total Débitos: Gs. </strong>
                            {{ liquidacion.total_debito|floatformat }}</li>
                            <input type="hidden" name="total_debito" value="{{ liquidacion.total_debito|unlocalize }}">
                        <br/>
                        <li class="list-inline-item"><strong>Total Créditos: Gs. </strong>
                            {{ liquidacion.total_credito|floatformat }}</li>
                            <input type="hidden" name="total_credito" value="{{ liquidacion.total_credito|unlocalize }}">
                        <br/>
                        <li class="list-inline-item"><strong>Monto Líquido: Gs. </strong>
                            {{ liquidacion.total_liquidacion|floatformat }}</li>
                            <input type="hidden" name="total_liquidacion" value="{{ liquidacion.total_liquidacion|unlocalize }}">
                        <br/>
                    </ul>
                </div>
            </div>
            <hr>
        </div>
    </div> <!-- Fin cuerpo -->

{% if liquidacion.estado_actual.name != 'Confirmado' %}
<div class="card" style="background-color: #b9bbbe">
  <div class="card-header">
    <strong>Vacaciones utilizadas</strong>
  </div>
  <div class="card-body" style="background-color: #b9bbbe">
    <div class="row">
        <div class="col-5">
            <label>Cantidad de días :</label>
        </div>
        <div class="col-3">
            {{ form.vacaciones_usadas }}
        </div>
    </div>
  </div>
</div>
<hr>
{% endif %}

<div class="card" style="background-color: #b9bbbe">
  <div class="card-header">
    <strong>Haberes del funcionario</strong>
  </div>
  <div class="card-body" style="background-color: #b9bbbe">
    <div class="row">
        <div class="col-12">
            <div class="row">
        <div class="col-lg-12">
        <table id="tabla_liqhaberes" class="table table-hover table-responsive">
            {% for item in liq_haberes %}
                {% ifchanged item.pk %}
                <thead>
                    <tr class="bg-secondary text-white" style="font-size: 15px">
                        {% if item.haber.movimiento.motivo.nombre != 'Contrato' %}
                            <th class="text-center">Categoria Salarial: {{ item.haber.movimiento.categoria_salarial }}</th>
                        {% else %}
                            <th class="text-center">Contrato N° : </th>
                        {% endif %}
                        <th class="text-center">Creditos: Gs.{{ item.monto_credito|floatformat }}</th>
                        <th class="text-center">Debitos: Gs.{{ item.monto_debito|floatformat }}</th>
                        <th class="text-center">Subtotal: Gs.{{ item.subTotal|floatformat }}</th>
                            <th class="text-center">
                                {% if item.editable is True %}
                                <button class="btn btn-secondary" type="button"
                                   name="go" value="Ir" onclick="location.href=('{% url 'liquidacion:editar_liquidacionhaber' item.pk %}')">
                                <i class="fa fa-pencil-square-o" style="font-size:25px" aria-hidden="true"></i></button>
                                {% endif %}
                        </th>
                    </tr>
                </thead>
                <thead>
                    <tr style="font-size: 15px">
                        <th colspan="1" class="text-center">Concepto</th>
                        <th colspan="2" class="text-center">Creditos</th>
                        <th colspan="2" class="text-center">Debitos</th>
                    </tr>
                </thead>
                <tbody>
                    {% for det in detalles %}
                        {% if det.liquidacion_haber == item %}
                            <tr style="font-size: 13px">
                                <td colspan="1">{{ det.variable.motivo }}</td>
                                {% if det.variable.tipo == 'C' %}
                                    <td colspan="2" class="text-center">Gs. {{ det.total_detalle|floatformat }}</td>
                                    <td colspan="2" class="text-center"> - </td>
                                {% else %}
                                    <td colspan="2" class="text-center"> - </td>
                                    <td colspan="2" class="text-center">Gs. {{ det.total_detalle|floatformat }}</td>
                                {% endif %}
                            </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
                {% endifchanged %}
            {% endfor %}
        </table>
        </div>
    </div>
        </div>
    </div>
  </div>
</div>



</form>


</div>

<div id="popup" class="modal fade" role="dialog">

</div>

{% endblock %}