{% extends "liquidacionmensual/liqmensual_list.html" %}
{% load staticfiles %}
{% load django_bootstrap_breadcrumbs %}
{% load humanize %}
{% load l10n %}

{% block breadcrumbs %}
    {{ block.super }}
    {% breadcrumb " Liquidaciones Pendientes " 'liquidacion:index' %}
{% endblock %}

{% block content %}
{% render_breadcrumbs %}

<div class="col-12 col-sm-10 recuadro">

{% if advertencia %}
<div class="alert alert-warning alert-dismissible fade show" role="alert">
    {{ advertencia }}
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
{% endif %}

    <div class="row"><!--titulo-->
        <div class="col-8">
            {% if liq_haber.haber.movimiento.motivo.nombre != 'Contrato' %}
            <h4>Rubro : {{ liq_haber.haber.movimiento.categoria_salarial }} -
                Cargo: {{ liq_haber.haber.movimiento.categoria_salarial.cargo }}</h4> <!--fin titulo-->
            {% else %}
            <h4>Contrato N° :  -
                Cargo: {{ liq_haber.haber.movimiento.funcion }} -
                Departamento: {{ liq_haber.haber.movimiento.division.departamento.nombre }}
            </h4> <!--fin titulo-->
            {% endif %}

        </div>
        <div class="col-4">
            <button type="button"
                    name="boton" value="liquidaciongeneral"
                    onclick="location.href=('{% url 'liquidacion:editar_liquidacion' liq_haber.liquidacion.pk %}')"
                    class="btn" style="width: 100%">
                Ir a Liquidacion Completa
            </button>
        </div>
    </div> <!--fin titulo-->
    <hr>

    <div class="row"> <!-- cabecera-->
        <div class="col-12" style="font-size: 12px">
            <div class="row">
                <div class="col-4 d-flex align-items-center">
                    <ul class="list-inline">
                        <li class="list-inline-item"><strong>Funcionario: </strong></li>
                        <br/>
                        <li class="list-inline-item">{{ liq_haber.liquidacion.funcionario }}</li>
                    </ul>
                </div>
                <div class="col-4 d-flex">
                    <ul class="list-inline">
                        <li class="list-inline-item"><strong>Creada el: </strong>
                            {{ liq_haber.liquidacion.fechacreacion|date:"d/m/Y H:i" }}</li>
                        <br/>
                        <li class="list-inline-item"><strong>Mes: </strong>{{ liq_haber.liquidacion.mes.nombre }}</li>
                        <br/>
                        <li class="list-inline-item">
                            <strong>Periodo: Del </strong>{{ liq_haber.liquidacion.inicio_periodo|date:"d/m/Y" }}
                            <strong>hasta el </strong>{{ liq_haber.liquidacion.fin_periodo|date:"d/m/Y" }}</li>
                        <br/>
                    </ul>
                </div>
                <div class="col-4 d-flex">
                     <ul class="list-inline">
                        <li class="list-inline-item"><strong>Total Débitos: Gs. </strong>
                            {{ liq_haber.liquidacion.total_debito|floatformat }}</li>
                        <br/>
                        <li class="list-inline-item"><strong>Total Créditos: Gs. </strong>
                            {{ liq_haber.liquidacion.total_credito|floatformat }}</li>
                        <br/>
                        <li class="list-inline-item"><strong>Monto Líquido: Gs. </strong>
                            {{ liq_haber.liquidacion.total_liquidacion|floatformat }}</li>
                        <br/>
                    </ul>
                </div>
            </div>
        </div>
    </div> <!-- Fin cabecera -->
<hr>

 <form method="post" id="liqhaber_form">
    {% csrf_token %}
        <!-- Campos ocultos -->
        <input type="hidden" name="haber" value="{{ liq_haber.haber }}">
        <input type="hidden" name="liquidacion" value="{{ liq_haber.liquidacion }}">
        <div class="row separador"></div>
        <div class="row mt-2">
            <div class="col-12 col-sm-4">
                <div class="form-group">
                    <label for="monto_debito">Debitos:</label>
                    {% if liq_haber %}
                        <input type="text" class="form-control"
                               value="{{ liq_haber.monto_debito|floatformat }}" disabled/>
                        <input type="hidden" name="monto_debito" value="{{ liq_haber.monto_debito|floatformat }}">
                    {% endif %}
                </div>
            </div>
            <div class="col-12 col-sm-4">
                <div class="form-group">
                    <label for="monto_credito">Creditos:</label>
                    {% if liq_haber %}
                        <input type="text" class="form-control"
                               value="{{ liq_haber.monto_credito|floatformat }}" disabled/>
                        <input type="hidden" name="monto_credito" value="{{ liq_haber.monto_credito|floatformat }}">
                    {% endif %}
                </div>
            </div>
        <div class="col-12 col-sm-4">
            <div class="form-group">
                <label for="subTotal">Monto a cobrar:</label>
                {% if liq_haber %}
                    <input type="text" class="form-control"
                           value="{{ liq_haber.subTotal|floatformat }}" disabled/>
                    <input type="hidden" name="subTotal" value="{{ liq_haber.subTotal }}">
                {% endif %}
            </div>
        </div>
    </div>

</form> <!-- FIN FORM -->
<hr>
    {% if liq_haber %}
        <div class="row">
            <div class="col-lg-10">
                <a onclick="return abrir_modal('{% url 'liquidacion:detalleliquidacion-add' liq_haber.pk %}')"
                   class="btn btn-primary">
                        <strong style="color: white">Agregar Detalle</strong>
                </a>
            </div>
        </div>
        <hr>
        <div class="row">
            <div class="col-lg-12">
                <table id="tabla_detalleliquidacion" class="table table-hover">
                    <thead class="thead-light">
                        <tr>
                            <th class="text-center">Descripcion</th>
                            <th class="text-center">Importe</th>
                            <th class="text-center">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for detalle in detalles_list %}
                            <tr class='clickable-row'>
                                <td class="text-center">{{ detalle.variable }}</td>
                                <td class="text-center">Gs. {{ detalle.total_detalle|floatformat }}</td>
                                <td class="text-center">
                                    <button class="btn btn-outline-primary btn-edit" type="button"
                                            onclick="location.href='{% url 'liquidacion:detalleliquidacion-delete' detalle.pk %}'">
                                        <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                    </button>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            </div>
    {% endif %}

</div>

<div id="popup" class="modal fade" role="dialog">

</div>

<footer>
    <script>

    function abrir_modal(url)
    {
        $('#popup').load(url, function()
        {
            $(this).modal('show');
        });
        return false;
    }

    function cerrar_modal()
    {
        $('#popup').modal('hide');
        return false;
    }

    </script>
</footer>
{% endblock %}