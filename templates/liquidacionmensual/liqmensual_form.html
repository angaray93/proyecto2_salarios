{% extends "liquidacionmensual/liqmensual_list.html" %}
{% load staticfiles %}
{% load django_bootstrap_breadcrumbs %}
{% load humanize %}
{% load l10n %}

{% block breadcrumbs %}
    {{ block.super }}
    {% breadcrumb " Liquidaciones Pendientes " 'liquidacion:index' %}
{% endblock %}

{% block content %}
{% render_breadcrumbs %}

<div class="col-12 col-sm-10 recuadro">

{% if advertencia %}
<div class="alert alert-warning alert-dismissible fade show" role="alert">
    {{ advertencia }}
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
{% endif %}

<form method="post" id="liquidacion_form">
    {% csrf_token %}
    <div class="row"><!--titulo-->
        <h4>Liquidacion Salarial Mensual</h4> <!--fin titulo-->
    </div> <!--fin titulo-->
    <hr>
    <div class="row mt-2"> <!-- botones -->
        <div class="col-12">
            <div class="row">
                <div class="col-md-3 col-sm-3 btn_sep">
                    <button type="submit" form="liquidacion_form"
                            name="boton" value="Descartado"
                            formaction="{% url 'liquidacion:editar_liquidacion' liquidacion.pk %}"
                            class="btn" style="width: 100%">
                        Descartar
                    </button>
                </div>
                <div class="col-md-3 col-sm-3 btn_sep">
                    <button type="submit" form="liquidacion_form"
                            name="boton" value="Confirmado"
                            formaction="{% url 'liquidacion:editar_liquidacion' liquidacion.pk %}"
                            class="btn" style="width: 100%">
                        Confirmar
                    </button>
                </div>
                <div class="col-md-3 col-sm-3 btn_sep">
                    <button type="submit" form="liquidacion_form"
                            name="boton" value="Borrador"
                            formaction="{% url 'liquidacion:editar_liquidacion' liquidacion.pk %}"
                            class="btn" style="width: 100%">
                        Guardar Borrador
                    </button>
                </div>
            </div>
        </div>
    </div><!-- fin botones -->
    <hr>
    <input type="hidden" name="ultimamodificacion" value="{{liquidacion.ultimamodificacion|unlocalize }}">
    <input type="hidden" name="propietario" value="{{ liquidacion.propietario }}">
    <input type="hidden" name="tipo" value="{{ liquidacion.tipo }}">
    <input type="hidden" name="estado_actual" value="{{ liquidacion.estado_actual.pk }}">

    <div class="row"> <!-- cuerpo del formulario-->
        <div class="col-12" style="font-size: 12px">
            <div class="row">
                <div class="col-4 d-flex align-items-center">
                    <ul class="list-inline">
                        <li class="list-inline-item"><strong>Funcionario: </strong></li>
                        <br/>
                        <li class="list-inline-item">{{ liquidacion.funcionario }}</li>
                        <input type="hidden" name="funcionario" value="{{ liquidacion.funcionario.pk }}">
                    </ul>
                </div>
                <div class="col-4 d-flex">
                    <ul class="list-inline">
                        <li class="list-inline-item"><strong>Creada el: </strong>
                            {{ liquidacion.fechacreacion|date:"d/m/Y H:i" }}</li>
                            <input type="hidden" name="fechacreacion" value="{{ liquidacion.fechacreacion|date:"Y-m-d H:i" }}">
                        <br/>
                        <li class="list-inline-item"><strong>Mes: </strong>{{ liquidacion.mes.nombre }}</li>
                            <input type="hidden" name="mes" value="{{ liquidacion.mes.pk }}">
                        <br/>
                        <li class="list-inline-item">
                            <strong>Periodo: Del </strong>{{ liquidacion.inicio_periodo|date:"d/m/Y" }}
                            <strong>hasta el </strong>{{ liquidacion.fin_periodo|date:"d/m/Y" }}</li>
                            <input type="hidden" name="inicio_periodo" value="{{ liquidacion.inicio_periodo|date:"Y-m-d H:i" }}">
                            <input type="hidden" name="fin_periodo" value="{{ liquidacion.fin_periodo|date:"Y-m-d H:i" }}">
                        <br/>
                    </ul>
                </div>
                <div class="col-4 d-flex">
                     <ul class="list-inline">
                        <li class="list-inline-item"><strong>Total Débitos: Gs. </strong>
                            {{ liquidacion.total_debito|floatformat }}</li>
                            <input type="hidden" name="total_debito" value="{{ liquidacion.total_debito|unlocalize }}">
                        <br/>
                        <li class="list-inline-item"><strong>Total Créditos: Gs. </strong>
                            {{ liquidacion.total_credito|floatformat }}</li>
                            <input type="hidden" name="total_credito" value="{{ liquidacion.total_credito|unlocalize }}">
                        <br/>
                        <li class="list-inline-item"><strong>Monto Líquido: Gs. </strong>
                            {{ liquidacion.total_liquidacion|floatformat }}</li>
                            <input type="hidden" name="total_liquidacion" value="{{ liquidacion.total_liquidacion|unlocalize }}">
                        <br/>
                    </ul>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col-lg-6" style="font-size: 14px">
                    <label>Vacaciones (Cantidad de dias utilizados durante el presente periodo):</label>
                </div>
                <div class="col-lg-6">
                    <div>
                        {{ form.vacaciones_usadas }}
                    </div>
                </div>
          </div>
        </div>
    </div> <!-- Fin cuerpo -->
</form>

<hr>

<div class="row">
        <div class="col-lg-12">
        <table id="tabla_liqhaberes" class="table table-hover">
            {% for item in liq_haberes %}
                {% ifchanged item.pk %}
                <thead class="thead-dark">
                    <tr>
                        {% if item.haber.movimiento.motivo.nombre != 'Contrato' %}
                            <th colspan="1">Categoria Salarial: {{ item.haber.movimiento.categoria_salarial }}</th>
                        {% else %}
                            <th colspan="1">Contrato N° : </th>
                        {% endif %}
                        <th colspan="1" >Monto Creditos: Gs.{{ item.monto_credito|floatformat }}</th>
                        <th colspan="1">Monto Debitos: Gs.{{ item.monto_debito|floatformat }}</th>
                        <th colspan="1">Subtotal: Gs.{{ item.subTotal|floatformat }}</th>
                        <th colspan="1" style="background-color: #b9bbbe; border-color: #b9bbbe">
                            <button class="btn btn-outline-primary" type="button"
                               name="go" value="Ir" onclick="location.href=('{% url 'liquidacion:editar_liquidacionhaber' item.pk %}')">
                            <i class="fa fa-pencil-square-o" aria-hidden="true"></i></button>
                        </th>
                    </tr>
                </thead>
                <thead class="thead-dark">
                    <tr>
                        <th colspan="2" class="text-center">Concepto</th>
                        <th colspan="1" class="text-center">Creditos</th>
                        <th colspan="1" class="text-center">Debitos</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="2">Asignacion Salarial</td>
                        {% if item.haber.movimiento.motivo.nombre != 'Contrato' %}
                            <td>Gs. {{ item.haber.movimiento.categoria_salarial.asignacion }}</td>
                        {% else %}
                            <td>Gs. {{ item.pago.monto|floatformat }}</td>
                        {% endif %}
                        <td> - </td>
                    </tr>
                    {% for con in constantes %}
                        {% if con.movimiento == item.haber.movimiento %}
                            <tr>
                                <td colspan="2">{{ con.tipo.nombre }}</td>
                                {% if con.tipo.tipo == 'C' %}
                                    <td>Gs. {{ con.monto|floatformat }}</td>
                                    <td> - </td>
                                {% else %}
                                    <td> - </td>
                                    <td>Gs. {{ con.monto|floatformat }}</td>
                                {% endif %}
                            </tr>
                        {% endif %}
                    {% endfor %}
                    {% for det in detalles %}
                        {% if det.liquidacion_haber == item %}
                            <tr>
                                <td colspan="2">{{ det.variable.motivo }}</td>
                                {% if det.variable.tipo == 'C' %}
                                    <td>Gs. {{ det.total_detalle|floatformat }}</td>
                                    <td> - </td>
                                {% else %}
                                    <td> - </td>
                                    <td>Gs. {{ det.total_detalle|floatformat }}</td>
                                {% endif %}
                            </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
                {% endifchanged %}
            {% endfor %}
        </table>
        </div>
    </div>


</div>

<div id="popup" class="modal fade" role="dialog">

</div>

{% endblock %}