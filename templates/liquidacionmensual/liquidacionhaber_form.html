{% extends "liquidacionmensual/liqmensual_list.html" %}
{% load staticfiles %}
{% load django_bootstrap_breadcrumbs %}
{% load humanize %}
{% load l10n %}

{% block breadcrumbs %}
    {{ block.super }}
    {% breadcrumb " Liquidaciones Pendientes " 'liquidacion:index' %}
{% endblock %}

{% block content %}
{% render_breadcrumbs %}

<div class="col-12 col-sm-10 recuadro">

{% if advertencia %}
<div class="alert alert-warning alert-dismissible fade show" role="alert">
    {{ advertencia }}
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
{% endif %}

 <form method="post" id="liqhaber_form"> <!--FORM -->
    {% csrf_token %}
    <hr>
        <input type="hidden" name="haber" value="{{ liq_haber.haber }}">
        <input type="hidden" name="liquidacion" value="{{ liq_haber.liquidacion }}">

        <div class="row separador"></div>
        <div class="row mt-2"> <!-- botones -->
                <div class="col-12">
                    <div class="row">
                        <div class="col-md-3 col-sm-3 btn_sep">
                            <button type="submit" form="liqhaber_form"
                                    name="guardar" value="Guardar"
                                    class="btn" style="width: 100%">
                                Guardar
                            </button>
                        </div>
                    </div>
                </div>
            </div><!-- fin botones -->
    <hr>
        <div class="row mt-2">
            <div class="col-12 col-sm-4">
                <div class="form-group">
                    <label for="monto_debito">Debitos:</label>
                    {% if liq_haber %}
                        <input type="text" class="form-control"
                               value="{{ liq_haber.monto_debito }}" disabled/>
                        <input type="hidden" name="monto_debito" value="{{ liq_haber.monto_debito }}">
                    {% endif %}
                </div>
            </div>
            <div class="col-12 col-sm-4">
                <div class="form-group">
                    <label for="monto_credito">Creditos:</label>
                    {% if liq_haber %}
                        <input type="text" class="form-control"
                               value="{{ liq_haber.monto_credito }}" disabled/>
                        <input type="hidden" name="monto_credito" value="{{ liq_haber.monto_credito }}">
                    {% endif %}
                </div>
            </div>
        <div class="col-12 col-sm-4">
            <div class="form-group">
                <label for="subTotal">Monto a cobrar:</label>
                {% if liq_haber %}
                    <input type="text" class="form-control"
                           value="{{ liq_haber.subTotal }}" disabled/>
                    <input type="hidden" name="subTotal" value="{{ liq_haber.subTotal }}">
                {% endif %}
            </div>
        </div>
    </div>

</form> <!-- FIN FORM -->
<hr>
    {% if liq_haber %}
        <div class="row">
            <div class="col-lg-10">
                <a onclick="return abrir_modal('{% url 'liquidacion:detalleliquidacion-add' contrato.pk %}')"
                   class="btn btn-primary">
                        Agregar Detalle
                </a>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-10">
                {% for message in messages %}
                    <div class="alert alert-danger">{{ message }}
                        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                    </div>
                {% endfor %}
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <table id="tabla_detalleliquidacion" class="table table-hover">
                    <thead class="thead-light">
                        <tr>
                            <th class="text-center">Nivel Sla</th>
                            <th class="text-center">Tiempo de respuesta(En minutos)</th>
                            <th class="text-center">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for sla in sla_list %}
                            <tr class='clickable-row'>
                                <td>{{ sla.nivel.nivel }}</td>
                                <td>{{ sla.tiempoderespuesta }}</td>
                                <td class="text-center">
                                    <button class="btn btn-outline-primary btn-edit" type="button"
                                            onclick="return abrir_modal('{% url 'Core:editar_sla' sla.contrato.pk sla.pk %}')">
                                        <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                    </button>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            </div>
        <div class="row">
                <div class="col-lg-12">
                    <table id="tabla_periodos" class="table table-hover">
                            <thead class="thead-light">
                                <tr>
                                    <th class="text-center">Numero de Periodo</th>
                                    <th class="text-center">Mes</th>
                                    <th class="text-center">Anho</th>
                                    <th class="text-center">Total de horas del periodo</th>
                                    <th class="text-center">Horas restantes</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for periodo in periodos %}
                                    <tr class='clickable-row'>
                                        <td>{{ periodo.numero }}</td>
                                        <td>{{ periodo.mes }}</td>
                                        <td>{{ periodo.anho }}</td>
                                        <td>{{ periodo.total_horas }}</td>
                                        <td>{{ periodo.horasrestantes }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                    </table>
                </div>
            </div>
    {% endif %}



</div>

<div id="popup" class="modal fade" role="dialog">

</div>

<footer>
    <script>

    function abrir_modal(url)
    {
        $('#popup').load(url, function()
        {
            $(this).modal('show');
        });
        return false;
    }

    function cerrar_modal()
    {
        $('#popup').modal('hide');
        return false;
    }

    </script>
</footer>
{% endblock %}