{% extends "liquidacionmensual/liqmensual_list.html" %}
{% load staticfiles %}
{% load django_bootstrap_breadcrumbs %}
{% load humanize %}
{% load l10n %}

{% block content %}

<div class="col-12 col-sm-10 recuadro">

{% if advertencia %}
<div class="alert alert-warning alert-dismissible fade show" role="alert">
    {{ advertencia }}
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
{% endif %}

<div class="row">
    <div class="col-lg-10">
        {% for message in messages %}
            <div class="alert alert-danger">{{ message }}
                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            </div>
        {% endfor %}
    </div>
</div>
<div class="row"> <!-- cabecera-->
        <div class="col-12" style="font-size: 12px">
            <div class="row text-center">
                <div class="col-12 text-center">
                    <h5><strong>Liquidacion Salarial N° {{ liq_haber.liquidacion.pk }}</strong></h5>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-4 d-flex align-items-center">
                    <ul class="list-inline">
                        <li class="list-inline-item"><strong>Funcionario: </strong></li>
                        <br/>
                        <li class="list-inline-item">{{ liq_haber.liquidacion.funcionario }}</li>
                    </ul>
                </div>
                <div class="col-4 d-flex">
                    <ul class="list-inline">
                        <li class="list-inline-item"><strong>Creada el: </strong>
                            {{ liq_haber.liquidacion.fechacreacion|date:"d/m/Y H:i" }}</li>
                        <br/>
                        <li class="list-inline-item"><strong>Mes: </strong>{{ liq_haber.liquidacion.mes.nombre }}</li>
                        <br/>
                        <li class="list-inline-item">
                            <strong>Periodo: Del </strong>{{ liq_haber.liquidacion.inicio_periodo|date:"d/m/Y" }}
                            <strong>hasta el </strong>{{ liq_haber.liquidacion.fin_periodo|date:"d/m/Y" }}</li>
                        <br/>
                    </ul>
                </div>
                <div class="col-4 d-flex">
                     <ul class="list-inline">
                        <li class="list-inline-item"><strong>Total Débitos: Gs. </strong>
                            {{ liq_haber.liquidacion.total_debito|floatformat }}</li>
                        <br/>
                        <li class="list-inline-item"><strong>Total Créditos: Gs. </strong>
                            {{ liq_haber.liquidacion.total_credito|floatformat }}</li>
                        <br/>
                        <li class="list-inline-item"><strong>Monto Líquido: Gs. </strong>
                            {{ liq_haber.liquidacion.total_liquidacion|floatformat }}</li>
                        <br/>
                    </ul>
                </div>
            </div>
        </div>
    </div> <!-- Fin cabecera -->
<hr>

<div class="row" style="font-size: 13px">
    {% if liq_haber.haber.movimiento.motivo.nombre != 'Contrato' %}
        <div class="col-3 text-center">
            <h6>Categoria Salarial: <strong>{{ liq_haber.haber.movimiento.categoria_salarial }}</strong></h6>
        </div>
        <div class="col-3 text-center">
            <h6>Cargo : <strong>{{ liq_haber.haber.movimiento.categoria_salarial.cargo }}</strong></h6>
        </div>
    {% else %}
        <div class="col-3 text-center">
            <h6>Contrato N°: <strong>{{ liq_haber.haber.movimiento.codigo }}</strong></h6>
        </div>
        <div class="col-3 text-center">
            <h6>Cargo : <strong>{{ liq_haber.haber.movimiento.funcion }}</strong></h6>
        </div>
    {% endif %}
        <div class="col-3 text-center">
            <h6>Departamento : <strong>{{ liq_haber.haber.movimiento.division.departamento.nombre }}</strong></h6>
        </div>

<div class="row mt-2">
<div class="col">
    <button type="button" form="liqhaber_form"
            name="boton" value="Guardar"
            onclick="location.href='{% url 'liquidacion:editar_liquidacion' liq_haber.liquidacion.pk %}'"
            class="btn btn-success" style="width: 100%">
        Ir a Liquidacion
    </button>
</div>

</div>

{% if liq_haber.editable is True %}
        {% if liq_haber.liquidacion.tipo.nombre == 'Mensual' %}
            <div class="col-3">
                <button type="submit" form="liqhaber_form"
                        name="boton" value="Guardar"
                        formaction="{% url 'liquidacion:editar_liquidacionhaber' liq_haber.pk %}"
                        class="btn btn-success" style="width: 100%">
                    Finalizar
                </button>
            </div>
        {% else %}
        <div class="col-3">
                <button type="submit" form="liqhaber_form"
                        name="boton" value="Finalizar"
                        formaction="{% url 'liquidacion:editar_liquidacionhaber' liq_haber.pk %}"
                        class="btn btn-success" style="width: 100%">
                    Finalizar
                </button>
            </div>
        {% endif %}
{% endif %}
</div>

<div id="formulario">
<hr>
 <form method="post" id="liqhaber_form">
    {% csrf_token %}
        <!-- Campos ocultos -->
        <input type="hidden" name="haber" value="{{ liq_haber.haber.pk }}">
        <input type="hidden" name="liquidacion" value="{{ liq_haber.liquidacion.pk }}">
        <input type="hidden" name="salario_proporcional" value="{{ liq_haber.salario_proporcional|unlocalize }}">
        {% if liq_haber.pago %}
            <input type="hidden" name="pago" value="{{ liq_haber.pago.pk }}">
        {% endif %}

        <div class="row separador"></div>
        <div class="row mt-2">
            <div class="col-12 col-sm-4">
                <div class="form-group">
                    <label for="monto_debito">Debitos:</label>
                    {% if liq_haber %}
                        <input type="text" class="form-control"
                               value="{{ liq_haber.monto_debito|floatformat }}" disabled/>
                        <input type="hidden" name="monto_debito" value="{{ liq_haber.monto_debito|unlocalize }}">
                    {% endif %}
                </div>
            </div>
            <div class="col-12 col-sm-4">
                <div class="form-group">
                    <label for="monto_credito">Creditos:</label>
                    {% if liq_haber %}
                        <input type="text" class="form-control"
                               value="{{ liq_haber.monto_credito|floatformat }}" disabled/>
                        <input type="hidden" name="monto_credito" value="{{ liq_haber.monto_credito|unlocalize }}">
                    {% endif %}
                </div>
            </div>
        <div class="col-12 col-sm-4">
            <div class="form-group">
                <label for="subTotal">Monto a cobrar:</label>
                {% if liq_haber %}
                    <input type="text" class="form-control"
                           value="{{ liq_haber.subTotal|floatformat }}" disabled/>
                    <input type="hidden" name="subTotal" value="{{ liq_haber.subTotal|unlocalize }}">
                {% endif %}
            </div>
        </div>
    </div>

</form> <!-- FIN FORM -->
</div>
<hr>
{% if liq_haber %}
    <div class="card" style="background-color: #b9bbbe">
      <div class="card-header">
        <div class="row">
            <div class="col-10">
                <strong>Detalle de débitos y créditos</strong>
            </div>
            <div class="col-2" style="">
                <button class="btn btn-primary btn-sm" type="button"
                        onclick="return abrir_modal('{% url 'liquidacion:detalleliquidacion-add' liq_haber.pk %}')">
                    <i class="fa fa-plus" style="font-size:25px" aria-hidden="true">
                    </i></button>
            </div>
        </div>
      </div>
      <div class="card-body" style="background-color: #b9bbbe">
         <div class="row">
                <div class="col-lg-12">
                    <table id="tabla_detalleliquidacion" class="table">
                        <thead class="thead-light">
                            <tr>
                                <th class="text-center">Descripcion</th>
                                <th class="text-center">Importe</th>
                                <th class="text-center">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for detalle in detalles_list %}
                                <tr class="text-dark" style="background-color: #c6c8ca; text">
                                    <td>{{ detalle.variable }}</td>
                                    <td class="text-center">Gs. {{ detalle.total_detalle|floatformat }}</td>
                                    <td class="text-center">
                                        <button class="btn btn-outline-danger" type="button"
                                                onclick="location.href='{% url 'liquidacion:detalleliquidacion-delete' detalle.pk %}'">
                                            <i class="fa fa-trash-o" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                </div>
      </div>
</div>

{% endif %}

</div>

<div id="popup" class="modal fade" role="dialog">

</div>

<footer>
    <script>
    $(document).ready(function () {
        $("#formulario").hide();
    });
    function abrir_modal(url)
    {
        $('#popup').load(url, function()
        {
            $(this).modal('show');
        });
        return false;
    }

    function cerrar_modal()
    {
        $('#popup').modal('hide');
        return false;
    }

    </script>
</footer>
{% endblock %}